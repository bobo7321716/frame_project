{"version":3,"sources":["assets\\homePage\\script\\scrollview\\RecycleScrollH.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["const { ccclass, property } = cc._decorator;\r\n\r\n/** \r\n * 循环+分帧 滑动面板 横向 \r\n */\r\n@ccclass\r\nexport default class RecycleScrollH extends cc.Component {\r\n    /** item预制 */\r\n    @property(cc.Prefab)\r\n    itemPrefab: cc.Prefab = null;\r\n\r\n    /** item间隔 */\r\n    @property(cc.Vec2)\r\n    spacing: cc.Vec2 = null;\r\n\r\n    /** item数量 */\r\n    private _numItems: number = 0;\r\n    // public get numItems() {\r\n    //     return this._numItems;\r\n    // }\r\n    // public set numItems(value: number) {\r\n    //     this._numItems = value;\r\n    //     this._hideAllItems();\r\n    //     this.updateAllItems();\r\n    //     this.scheduleOnce(() => {\r\n    //         this._initialize();\r\n    //         this._updateContentHeight();\r\n    //     });\r\n    // }\r\n\r\n    /** 视图内显示列数 */\r\n    private _viewCol: number = 0;\r\n    /** 视图内显示行数 */\r\n    private _viewRow: number = 0;\r\n    /** 视图窗宽 */\r\n    private _viewW: number = 0;\r\n    /** 视图窗高 */\r\n    private _viewH: number = 0;\r\n    /** item格子宽 */\r\n    private _itemW: number = 0;\r\n    /** item格子高 */\r\n    private _itemH: number = 0;\r\n    /** content上一次x坐标 */\r\n    private _lastPosX: number = 0;\r\n    /** 是否已初始化 */\r\n    private _isInit: boolean = false;\r\n    /** item的index */\r\n    private _itemsUUIDToIndex: { [uuid: string]: number } = {};\r\n\r\n    /** item列表 */\r\n    public itemList: cc.Node[] = [];\r\n    /** item父节点 */\r\n    public content: cc.Node = null;\r\n\r\n    /** item刷新回调 */\r\n    public onItemRender(index: number, node: cc.Node) { }\r\n    /** item点击回调 */\r\n    public onItemClicked(index: number, node: cc.Node) { }\r\n\r\n    /**\r\n     * 初始化滚动列表\r\n     * @param dataLength 全部数据长度\r\n     * @param finishCb 初始化完成回调\r\n     * @param onItemRender item刷新回调\r\n     * @param onItemClicked item点击回调\r\n     */\r\n    public init(dataLength: number, finishCb?: () => void, onItemRender?: (index: number, node: cc.Node) => void, onItemClicked?: (index: number, node: cc.Node) => void) {\r\n        this.onItemRender = onItemRender;\r\n        this.onItemClicked = onItemClicked;\r\n        this.refresh(dataLength, finishCb);\r\n    }\r\n\r\n    refresh(dataLength: number, cb: () => void = null) {\r\n        this._numItems = dataLength;\r\n        this._hideAllItems();\r\n        this.updateAllItems();\r\n        this._initialize(() => {\r\n            this._updateContentHeight();\r\n            cb && cb();\r\n        })\r\n    }\r\n\r\n    /**将指定下标的item滚动到屏幕中间 */\r\n    public rollItemByIndex(index: number, time: number = 0.1, xOffset: number = 0) {\r\n        if (!this._isInit) {\r\n            this.scheduleOnce(() => {\r\n                this.rollItemByIndex(index, time, xOffset);\r\n            }, 0)\r\n            return;\r\n        }\r\n        let targetX = Math.abs(index * this._itemW + this._itemW / 2) - this._itemW / 2 - (this._itemW - this._itemW) / 2 + xOffset;\r\n        const scroll = this.node.getComponent(cc.ScrollView);\r\n        scroll.scrollToOffset(cc.v2(0, targetX), time)\r\n        return new Promise((resolve, reject) => {\r\n            setTimeout(() => {\r\n                resolve(null);\r\n            }, time * 1000);\r\n        })\r\n    }\r\n\r\n    /** 刷新所有item */\r\n    public updateAllItems() {\r\n        this.itemList.forEach((item: cc.Node, index: number) => {\r\n            this._updateItem(this._itemsUUIDToIndex[item.uuid], item);\r\n        });\r\n    }\r\n\r\n    private _hideAllItems() {\r\n        this.itemList.forEach((item: cc.Node, index: number) => {\r\n            item.active = false;\r\n        });\r\n    }\r\n\r\n    /** 获取content */\r\n    private _getContent() {\r\n        return this.node.getComponent(cc.ScrollView).content;\r\n    }\r\n\r\n    /** 初始化 */\r\n    private _initialize(initCb: () => void) {\r\n        if (this._isInit) return;\r\n        const scroll = this.node.getComponent(cc.ScrollView);\r\n        scroll.enabled = false;\r\n        this._isInit = true;\r\n        const content = this._getContent();\r\n        this.content = content;\r\n        this._viewW = content.parent.width;\r\n        this._viewH = content.parent.height;\r\n\r\n        const itemData = this.itemPrefab.data;\r\n        this._itemW = itemData.width + this.spacing.x;\r\n        this._itemH = itemData.height + this.spacing.y;\r\n\r\n        this._lastPosX = content.y;\r\n        this._viewRow = Math.floor(this._viewH / this._itemH);\r\n        this._viewCol = Math.ceil(this._viewW / this._itemW) + 1;\r\n        const surplusH = this._viewH - (this._viewRow * this._itemH);\r\n        const startPos = cc.v2(this._itemW >> 1, (this._viewH >> 1) - (this._itemH >> 1) - (surplusH >> 1));\r\n\r\n        const cNum = this._viewRow * this._viewCol;\r\n        cc.log(`实例化数量:${cNum}`);\r\n\r\n        let createNum = 0;\r\n        const createFunc = (index: number) => {\r\n            if (!cc.isValid(content)) return; //异步创建，创建完回来父节点有可能已经被销毁 \r\n            const item = cc.instantiate(this.itemPrefab);\r\n            item.parent = content;\r\n            const x = Math.floor(index / this._viewRow) * this._itemW + (this.spacing.x >> 1);\r\n            const y = (index % this._viewRow) * this._itemH;\r\n            const pos = startPos.add(cc.v2(x, y));\r\n            item.setPosition(pos);\r\n            item.on(cc.Node.EventType.TOUCH_END, (e: cc.Event.EventTouch) => {\r\n                this.onItemClicked && this.onItemClicked(this._itemsUUIDToIndex[item.uuid], item);\r\n            }, this);\r\n            this.itemList.push(item);\r\n\r\n            this._updateItem(index, item);\r\n\r\n            this._itemsUUIDToIndex[item.uuid] = index;\r\n\r\n            createNum++;\r\n            if (createNum == cNum) {\r\n                scroll.enabled = true;\r\n                initCb && initCb();\r\n            }\r\n        }\r\n        /** 分帧创建item */\r\n        frameLoad(cNum, createFunc, 1);\r\n    }\r\n\r\n    /** 更新centent高度 */\r\n    private _updateContentHeight() {\r\n        const content = this._getContent();\r\n        const row = Math.floor(this._viewH / this._itemH);\r\n        const col = Math.ceil(this._numItems / row);\r\n        content.width = col * (this.itemPrefab.data.width + this.spacing.x) - (this.spacing.x);\r\n    }\r\n\r\n    /** 获取item在view坐标系的对标 */\r\n    private _getPosInView(item: cc.Node) {\r\n        const content = this._getContent();\r\n        const view = content.parent;\r\n        const wpos = content.convertToWorldSpaceAR(item.position);\r\n        const lpos = view.convertToNodeSpaceAR(wpos);\r\n        return lpos;\r\n    }\r\n\r\n    /** 更新item */\r\n    private _updateItem(index: number, item: cc.Node) {\r\n        const isShow = index >= 0 && index < this._numItems;\r\n        item.active = isShow;\r\n        if (isShow && this.onItemRender) {\r\n            this.onItemRender(index, item);\r\n        }\r\n    }\r\n\r\n    public update(dt: number) {\r\n        const content = this._getContent();\r\n        const currX = content.x;\r\n        const dtX = currX - this._lastPosX;\r\n        this._lastPosX = currX;\r\n        if (dtX == 0) return;\r\n        const isRight = dtX > 0;\r\n        const itemsLen = this.itemList.length;\r\n        for (let i = 0; i < itemsLen; ++i) {\r\n            const item = this.itemList[i];\r\n            const posInView = this._getPosInView(item);\r\n            const viewHalfW = this._viewW >> 1;\r\n            const itemHalfW = this._itemW >> 1;\r\n            const lastIndex = this._itemsUUIDToIndex[item.uuid];\r\n            let currIndex = lastIndex;\r\n            if (!isRight) {\r\n                if (posInView.x <= -viewHalfW - itemHalfW) {\r\n                    item.x += (this._viewCol * this._itemW);\r\n                    currIndex = lastIndex + itemsLen;\r\n                }\r\n            } else {\r\n                if (posInView.x >= viewHalfW + itemHalfW) {\r\n                    item.x -= (this._viewCol * this._itemW);\r\n                    currIndex = lastIndex - itemsLen;\r\n                }\r\n            }\r\n            if (currIndex != lastIndex) {\r\n                this._updateItem(currIndex, item);\r\n            }\r\n            this._itemsUUIDToIndex[item.uuid] = currIndex;\r\n        }\r\n    }\r\n}\r\n\r\n/** 分帧执行 */\r\nfunction frameLoad(loopTimes: number, func: Function, frameTime: number = 16, __index: number = 0) {\r\n    let loop = loopTimes;\r\n    let start = new Date().getTime();\r\n    let end = 0;\r\n    let dt = 0;\r\n    for (let i = 0; i < loop; ++i) {\r\n        if (__index >= loop) {\r\n            break;\r\n        }\r\n        try {\r\n            func && func(__index);\r\n        } catch (e) {\r\n            cc.error(e);\r\n        }\r\n        __index++;\r\n        end = new Date().getTime();\r\n        dt = end - start;\r\n        if (dt > frameTime) {\r\n            setTimeout(() => {\r\n                frameLoad(loop, func, frameTime, __index);\r\n            }, 150);\r\n            break;\r\n        }\r\n    }\r\n}\r\n\r\n"]}